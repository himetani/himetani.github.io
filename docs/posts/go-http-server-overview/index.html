<!doctype html>
<html
  lang="ja"
  dir="ltr"
>
  <head>
    <meta charset="utf-8" />
<meta name="language" content="en" />
<meta name="viewport" content="width=device-width" />
<title>
    Goのhttp serverの雰囲気を理解する | himetani&#39;s cafe
</title>
  <meta name="description" content=" Goのhttp serverの雰囲気を理解する Goのhttpサーバの雰囲気を理解するための記事を書いた。" />
<meta property="og:url" content="https://himetani.github.io/posts/go-http-server-overview/">
  <meta property="og:site_name" content="himetani&#39;s cafe">
  <meta property="og:title" content="Goのhttp serverの雰囲気を理解する">
  <meta property="og:description" content="Goのhttp serverの雰囲気を理解する Goのhttpサーバの雰囲気を理解するための記事を書いた。">
  <meta property="og:locale" content="ja">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2018-04-30T00:21:25+09:00">
    <meta property="article:modified_time" content="2018-04-30T00:21:25+09:00">
    <meta property="article:tag" content="Golang">
    <meta property="article:tag" content="Http">


  <meta itemprop="name" content="Goのhttp serverの雰囲気を理解する">
  <meta itemprop="description" content="Goのhttp serverの雰囲気を理解する Goのhttpサーバの雰囲気を理解するための記事を書いた。">
  <meta itemprop="datePublished" content="2018-04-30T00:21:25+09:00">
  <meta itemprop="dateModified" content="2018-04-30T00:21:25+09:00">
  <meta itemprop="wordCount" content="4527">
  <meta itemprop="keywords" content="Golang,Http">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Goのhttp serverの雰囲気を理解する">
  <meta name="twitter:description" content="Goのhttp serverの雰囲気を理解する Goのhttpサーバの雰囲気を理解するための記事を書いた。">

<link rel="canonical" href="https://himetani.github.io/posts/go-http-server-overview/" />

      <link
        rel="stylesheet"
        href="/css/index.min.02cc00ef9b3ae458f5cb05c0f4ea7f39d3f3212262170558d138610de894495a.css"
        integrity="sha256-AswA75s65Fj1ywXA9Op/OdPzISJiFwVY0ThhDeiUSVo="
        crossorigin="anonymous"
      />


      <script
        src="/js/main.bbee9f2eac23db245a80660b41f5c5b77e27033c35737ef4fa111702c360409b.js"
        integrity="sha256-u&#43;6fLqwj2yRagGYLQfXFt34nAzw1c370&#43;hEXAsNgQJs="
        crossorigin="anonymous"
        defer
      ></script>
  

<script type="application/ld+json">
{
  "@context": "https://schema.org/",
  "@id": "https://himetani.github.io/posts/go-http-server-overview/",
  "@type": "BlogPosting",
  "author": {
    "@type": "Person",
    "name": "Takafumi Tsukamoto"
  },
  "copyrightNotice": "Takafumi Tsukamoto",
  "datePublished": "2018-04-30",
  "description": " Goのhttp serverの雰囲気を理解する Goのhttpサーバの雰囲気を理解するための記事を書いた。",
  "headline": "Goのhttp Serverの雰囲気を理解する",
  "isPartOf": {
    "@id": "https://himetani.github.io/posts/",
    "@type": "Blog",
    "name": "Posts"
  },
  "keywords": [
    "Golang",
    "Http"
  ],
  "mainEntityOfPage": "https://himetani.github.io/posts/go-http-server-overview/",
  "name": "Goのhttp Serverの雰囲気を理解する",
  "timeRequired": "PT10M",
  "url": "https://himetani.github.io/posts/go-http-server-overview/",
  "wordCount": 4527
}
</script>


  </head>
  <body>
    <div class="container mx-auto flex max-w-prose flex-col space-y-10 p-4 md:p-6">
      <header class="flex flex-row items-center justify-between">
        <div>
  <a id="skip-nav" class="sr-only" href="#maincontent">Skip to main content</a>
  <a class="font-semibold" href="/">himetani&#39;s cafe</a>
</div>

  <nav>
    <ul class="flex flex-row items-center justify-end space-x-4">
    <li>
      <a>Notes</a
      >
    </li>
    <li>
      <a aria-current="true" class="ancestor" href="/posts/">Posts</a
      >
    </li>
    <li>
      <a href="/graph/">Graph</a
      >
    </li>
    </ul>
  </nav>


      </header>
      <main class="prose prose-slate relative md:prose-lg prose-h1:text-[2em]" id="maincontent">
        <article class="main">
    <header>
      <h1 class="!mb-1">Goのhttp Serverの雰囲気を理解する</h1><div class="flex flex-row items-center space-x-4">
          <time class="text-sm italic opacity-80" datetime="2018-04-30T00:21:25&#43;09:00"
            >April 30, 2018</time
          >
        </div>
    </header>

    <h2 id="goのhttp-serverの雰囲気を理解する" class="scroll-mt-8 group">
  Goのhttp serverの雰囲気を理解する
  
    <a href="#go%e3%81%aehttp-server%e3%81%ae%e9%9b%b0%e5%9b%b2%e6%b0%97%e3%82%92%e7%90%86%e8%a7%a3%e3%81%99%e3%82%8b"
        class="no-underline hidden opacity-50 hover:opacity-100 !text-inherit group-hover:inline-block"
        aria-hidden="true" title="Link to this heading" tabindex="-1">
        <svg
  xmlns="http://www.w3.org/2000/svg"
  width="16"
  height="16"
  fill="none"
  stroke="currentColor"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  class="lucide lucide-link w-4 h-4 block"
  viewBox="0 0 24 24"
>
  <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" />
  <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" />
</svg>

    </a>
  
</h2>
<p>Goのhttpサーバの雰囲気を理解するための記事を書いた。</p>
<h2 id="tl-dr" class="scroll-mt-8 group">
  tl; dr
  
    <a href="#tl-dr"
        class="no-underline hidden opacity-50 hover:opacity-100 !text-inherit group-hover:inline-block"
        aria-hidden="true" title="Link to this heading" tabindex="-1">
        <svg
  xmlns="http://www.w3.org/2000/svg"
  width="16"
  height="16"
  fill="none"
  stroke="currentColor"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  class="lucide lucide-link w-4 h-4 block"
  viewBox="0 0 24 24"
>
  <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" />
  <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" />
</svg>

    </a>
  
</h2>
<ul>
<li>Goのhttpサーバの肝は<code>Handler</code>インタフェースなので、<code>Handler</code>インタフェースに注目すると雰囲気が掴みやすい。</li>
<li><code>Handler</code>インタフェースが、ライブラリやフレームワークを実現するための拡張性、柔軟性を提供している。（すごい）</li>
</ul>
<h2 id="handlerインタフェースとは" class="scroll-mt-8 group">
  Handlerインタフェースとは
  
    <a href="#handler%e3%82%a4%e3%83%b3%e3%82%bf%e3%83%95%e3%82%a7%e3%83%bc%e3%82%b9%e3%81%a8%e3%81%af"
        class="no-underline hidden opacity-50 hover:opacity-100 !text-inherit group-hover:inline-block"
        aria-hidden="true" title="Link to this heading" tabindex="-1">
        <svg
  xmlns="http://www.w3.org/2000/svg"
  width="16"
  height="16"
  fill="none"
  stroke="currentColor"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  class="lucide lucide-link w-4 h-4 block"
  viewBox="0 0 24 24"
>
  <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" />
  <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" />
</svg>

    </a>
  
</h2>
<figure class="codeblock not-prose relative scroll-mt-8" id="codeblock-01">
  <aside
    class="absolute right-0 top-0 hidden rounded-bl-sm rounded-tr-sm bg-white/10 px-2 py-1 text-white/70 transition-opacity md:inline-block"
  >
    <div class="codeblock-meta flex max-w-xs flex-row items-center space-x-3">
      <div class="small-caps shrink cursor-default truncate font-mono text-xs" aria-hidden="true">
        <span class="relative"></span>
      </div>
      <div>
        <clipboard-copy
          type="button"
          aria-label="Copy code to clipboard"
          title="Copy code to clipboard"
          class="block cursor-pointer transition-colors hover:text-sky-400"
          target="#codeblock-01 code"
        >
          <svg
  xmlns="http://www.w3.org/2000/svg"
  fill="none"
  stroke="currentColor"
  stroke-width="2"
  stroke-linecap="round"
  stroke-linejoin="round"
  class="lucide lucide-clipboard h-4 w-4"
  viewBox="0 0 24 24"
>
  <rect width="8" height="4" x="8" y="2" rx="1" ry="1" />
  <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" />
</svg>

        </clipboard-copy>
      </div>
      <div>
        <a
          href="#codeblock-01"
          class="block"
          aria-label="Link to this code block"
          title="Link to this code block"
        >
          <svg
  xmlns="http://www.w3.org/2000/svg"
  width="16"
  height="16"
  fill="none"
  stroke="currentColor"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  class="lucide lucide-link w-4 h-4 block"
  viewBox="0 0 24 24"
>
  <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" />
  <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" />
</svg>

        </a>
      </div>
    </div>
  </aside>
  <p class="sr-only"> code snippet start</p>
  <pre tabindex="0"><code>type Handler interface {
	ServeHTTP(ResponseWriter, *Request)
}</code></pre>
  <p class="sr-only"> code snippet end</p>

  
</figure>
<p>第一引数にResponseWriter型、第二引数にRequestのポインタ型を取る<code>ServeHTTP</code>というメソッドを実装している型を扱うためのインタフェース。
Goのhttpサーバは、この<code>Handler</code>インタフェースを上手く使っている。<br>
以下の説明で、<code>Handler</code>インタフェースという文言は、標準パッケージの<code>http.Handler</code>を指しているものとする。</p>
<h2 id="始めてhttpサーバを立てるとき" class="scroll-mt-8 group">
  始めてhttpサーバを立てるとき
  
    <a href="#%e5%a7%8b%e3%82%81%e3%81%a6http%e3%82%b5%e3%83%bc%e3%83%90%e3%82%92%e7%ab%8b%e3%81%a6%e3%82%8b%e3%81%a8%e3%81%8d"
        class="no-underline hidden opacity-50 hover:opacity-100 !text-inherit group-hover:inline-block"
        aria-hidden="true" title="Link to this heading" tabindex="-1">
        <svg
  xmlns="http://www.w3.org/2000/svg"
  width="16"
  height="16"
  fill="none"
  stroke="currentColor"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  class="lucide lucide-link w-4 h-4 block"
  viewBox="0 0 24 24"
>
  <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" />
  <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" />
</svg>

    </a>
  
</h2>
<p>ググってみて、以下のようなコードを書くはず。</p>
<figure class="codeblock not-prose relative scroll-mt-8" id="codeblock-02">
  <aside
    class="absolute right-0 top-0 hidden rounded-bl-sm rounded-tr-sm bg-white/10 px-2 py-1 text-white/70 transition-opacity md:inline-block"
  >
    <div class="codeblock-meta flex max-w-xs flex-row items-center space-x-3">
      <div class="small-caps shrink cursor-default truncate font-mono text-xs" aria-hidden="true">
        <span class="relative">go</span>
      </div>
      <div>
        <clipboard-copy
          type="button"
          aria-label="Copy code to clipboard"
          title="Copy code to clipboard"
          class="block cursor-pointer transition-colors hover:text-sky-400"
          target="#codeblock-02 code"
        >
          <svg
  xmlns="http://www.w3.org/2000/svg"
  fill="none"
  stroke="currentColor"
  stroke-width="2"
  stroke-linecap="round"
  stroke-linejoin="round"
  class="lucide lucide-clipboard h-4 w-4"
  viewBox="0 0 24 24"
>
  <rect width="8" height="4" x="8" y="2" rx="1" ry="1" />
  <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" />
</svg>

        </clipboard-copy>
      </div>
      <div>
        <a
          href="#codeblock-02"
          class="block"
          aria-label="Link to this code block"
          title="Link to this code block"
        >
          <svg
  xmlns="http://www.w3.org/2000/svg"
  width="16"
  height="16"
  fill="none"
  stroke="currentColor"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  class="lucide lucide-link w-4 h-4 block"
  viewBox="0 0 24 24"
>
  <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" />
  <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" />
</svg>

        </a>
      </div>
    </div>
  </aside>
  <p class="sr-only">go code snippet start</p>
  <div class="highlight"><pre tabindex="0" style="color:#c8d3f5;background-color:#222436;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#86e1fc">package</span> main
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#86e1fc">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#c3e88d">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#c3e88d">&#34;net/http&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#c099ff">type</span> fuga <span style="color:#4fd6be">int</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#c099ff">func</span> (f <span style="color:#c3e88d;font-weight:bold">*</span>fuga) <span style="color:#82aaff">ServeHTTP</span>(w http.ResponseWriter, r <span style="color:#c3e88d;font-weight:bold">*</span>http.Request) {
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#82aaff">Fprintf</span>(w, <span style="color:#c3e88d">&#34;fuga type: %d&#34;</span>, <span style="color:#c3e88d;font-weight:bold">*</span>f)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#c099ff">func</span> <span style="color:#82aaff">main</span>() {
</span></span><span style="display:flex;"><span>	http.<span style="color:#82aaff">HandleFunc</span>(<span style="color:#c3e88d">&#34;/hoge&#34;</span>, <span style="color:#c099ff">func</span>(w http.ResponseWriter, r <span style="color:#c3e88d;font-weight:bold">*</span>http.Request) {
</span></span><span style="display:flex;"><span>		fmt.<span style="color:#82aaff">Fprintf</span>(w, <span style="color:#c3e88d">&#34;Hello world&#34;</span>)
</span></span><span style="display:flex;"><span>	})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	f <span style="color:#c3e88d;font-weight:bold">:=</span> <span style="color:#82aaff">fuga</span>(<span style="color:#ffc777">1</span>)
</span></span><span style="display:flex;"><span>	http.<span style="color:#82aaff">Handle</span>(<span style="color:#c3e88d">&#34;/fuga&#34;</span>, <span style="color:#c3e88d;font-weight:bold">&amp;</span>f)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#c099ff">if</span> err <span style="color:#c3e88d;font-weight:bold">:=</span> http.<span style="color:#82aaff">ListenAndServe</span>(<span style="color:#c3e88d">&#34;:8080&#34;</span>, <span style="color:#ffc777">nil</span>); err <span style="color:#c3e88d;font-weight:bold">!=</span> <span style="color:#ffc777">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#c3e88d">panic</span>(err)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
  <p class="sr-only">go code snippet end</p>

  
</figure>
<p><code>HandleFunc</code>メソッドや<code>Handle</code>メソッドを使ってhandlerを登録することができるのだな、handlerは特定のURLにマッピングされ、マッチするURLへのアクセス時にhandlerが実行されるのだな、と直感的に理解できると思う。</p>
<h2 id="本格的に使おうとするとき" class="scroll-mt-8 group">
  本格的に使おうとするとき
  
    <a href="#%e6%9c%ac%e6%a0%bc%e7%9a%84%e3%81%ab%e4%bd%bf%e3%81%8a%e3%81%86%e3%81%a8%e3%81%99%e3%82%8b%e3%81%a8%e3%81%8d"
        class="no-underline hidden opacity-50 hover:opacity-100 !text-inherit group-hover:inline-block"
        aria-hidden="true" title="Link to this heading" tabindex="-1">
        <svg
  xmlns="http://www.w3.org/2000/svg"
  width="16"
  height="16"
  fill="none"
  stroke="currentColor"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  class="lucide lucide-link w-4 h-4 block"
  viewBox="0 0 24 24"
>
  <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" />
  <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" />
</svg>

    </a>
  
</h2>
<p>登録するhandlerの数が増えたり、より複雑になってくると、もっと上手くやれないものかと思うはず。例えば以下のようなもの。</p>
<ul>
<li>様々なhandler間で共通の処理を上手く書けないか
<ul>
<li>ロギング</li>
<li>認証</li>
<li>Header情報に基づく共通処理、など</li>
</ul>
</li>
<li>もっと便利にroutingの設定をできないか
<ul>
<li>個別のHTTPメソッドに対してhandlerを登録したい</li>
<li>path parameterを簡単にハンドリングしたい、など</li>
</ul>
</li>
</ul>
<p>サードパーティのライブラリやフレームワークを使えば、これらの要望を満たすことができる。では、サードパーティのライブラリやフレームワークは、何を、どのように実装しているのだろうか。それらの雰囲気を理解するために、まずは標準のhttpサーバの挙動の雰囲気を追ってみる。</p>
<h2 id="標準ライブラリのhttpサーバの挙動" class="scroll-mt-8 group">
  標準ライブラリのhttpサーバの挙動
  
    <a href="#%e6%a8%99%e6%ba%96%e3%83%a9%e3%82%a4%e3%83%96%e3%83%a9%e3%83%aa%e3%81%aehttp%e3%82%b5%e3%83%bc%e3%83%90%e3%81%ae%e6%8c%99%e5%8b%95"
        class="no-underline hidden opacity-50 hover:opacity-100 !text-inherit group-hover:inline-block"
        aria-hidden="true" title="Link to this heading" tabindex="-1">
        <svg
  xmlns="http://www.w3.org/2000/svg"
  width="16"
  height="16"
  fill="none"
  stroke="currentColor"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  class="lucide lucide-link w-4 h-4 block"
  viewBox="0 0 24 24"
>
  <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" />
  <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" />
</svg>

    </a>
  
</h2>
<p>Goのソースコードから、雰囲気を汲み取ってみる。長ったらしいので、退屈であれば<a href="#anchor">主要な構成要素とHandlerインタフェース</a>まで読み飛ばしてもらってもいいと思う。
まずは、<code>http.ListenAndServe(&quot;:8080&quot;, nil)</code>の実行後の挙動を追う。</p>
<figure class="codeblock not-prose relative scroll-mt-8" id="codeblock-03">
  <aside
    class="absolute right-0 top-0 hidden rounded-bl-sm rounded-tr-sm bg-white/10 px-2 py-1 text-white/70 transition-opacity md:inline-block"
  >
    <div class="codeblock-meta flex max-w-xs flex-row items-center space-x-3">
      <div class="small-caps shrink cursor-default truncate font-mono text-xs" aria-hidden="true">
        <span class="relative">go</span>
      </div>
      <div>
        <clipboard-copy
          type="button"
          aria-label="Copy code to clipboard"
          title="Copy code to clipboard"
          class="block cursor-pointer transition-colors hover:text-sky-400"
          target="#codeblock-03 code"
        >
          <svg
  xmlns="http://www.w3.org/2000/svg"
  fill="none"
  stroke="currentColor"
  stroke-width="2"
  stroke-linecap="round"
  stroke-linejoin="round"
  class="lucide lucide-clipboard h-4 w-4"
  viewBox="0 0 24 24"
>
  <rect width="8" height="4" x="8" y="2" rx="1" ry="1" />
  <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" />
</svg>

        </clipboard-copy>
      </div>
      <div>
        <a
          href="#codeblock-03"
          class="block"
          aria-label="Link to this code block"
          title="Link to this code block"
        >
          <svg
  xmlns="http://www.w3.org/2000/svg"
  width="16"
  height="16"
  fill="none"
  stroke="currentColor"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  class="lucide lucide-link w-4 h-4 block"
  viewBox="0 0 24 24"
>
  <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" />
  <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" />
</svg>

        </a>
      </div>
    </div>
  </aside>
  <p class="sr-only">go code snippet start</p>
  <div class="highlight"><pre tabindex="0" style="color:#c8d3f5;background-color:#222436;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ffc777">2966</span> <span style="color:#444a73;font-style:italic">// ListenAndServe always returns a non-nil error.</span>
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2967</span> <span style="color:#c099ff">func</span> <span style="color:#82aaff">ListenAndServe</span>(addr <span style="color:#4fd6be">string</span>, handler Handler) <span style="color:#4fd6be">error</span> {
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2968</span>     server <span style="color:#c3e88d;font-weight:bold">:=</span> <span style="color:#c3e88d;font-weight:bold">&amp;</span>Server{Addr: addr, Handler: handler}
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2969</span>     <span style="color:#c099ff">return</span> server.<span style="color:#82aaff">ListenAndServe</span>()
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2970</span> }</span></span></code></pre></div>
  <p class="sr-only">go code snippet end</p>

  
</figure>
<p><code>Server</code>を初期化して、初期化した<code>Server</code>の<code>ListenAndServe</code>メソッドを呼び出す。<br>
<code>Server</code>は<code>Handler</code>インタフェースを持つが、これがすごく重要。<br>
具象型ではなく、インタフェースになっているのがポイント。</p>
<figure class="codeblock not-prose relative scroll-mt-8" id="codeblock-04">
  <aside
    class="absolute right-0 top-0 hidden rounded-bl-sm rounded-tr-sm bg-white/10 px-2 py-1 text-white/70 transition-opacity md:inline-block"
  >
    <div class="codeblock-meta flex max-w-xs flex-row items-center space-x-3">
      <div class="small-caps shrink cursor-default truncate font-mono text-xs" aria-hidden="true">
        <span class="relative">go</span>
      </div>
      <div>
        <clipboard-copy
          type="button"
          aria-label="Copy code to clipboard"
          title="Copy code to clipboard"
          class="block cursor-pointer transition-colors hover:text-sky-400"
          target="#codeblock-04 code"
        >
          <svg
  xmlns="http://www.w3.org/2000/svg"
  fill="none"
  stroke="currentColor"
  stroke-width="2"
  stroke-linecap="round"
  stroke-linejoin="round"
  class="lucide lucide-clipboard h-4 w-4"
  viewBox="0 0 24 24"
>
  <rect width="8" height="4" x="8" y="2" rx="1" ry="1" />
  <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" />
</svg>

        </clipboard-copy>
      </div>
      <div>
        <a
          href="#codeblock-04"
          class="block"
          aria-label="Link to this code block"
          title="Link to this code block"
        >
          <svg
  xmlns="http://www.w3.org/2000/svg"
  width="16"
  height="16"
  fill="none"
  stroke="currentColor"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  class="lucide lucide-link w-4 h-4 block"
  viewBox="0 0 24 24"
>
  <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" />
  <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" />
</svg>

        </a>
      </div>
    </div>
  </aside>
  <p class="sr-only">go code snippet start</p>
  <div class="highlight"><pre tabindex="0" style="color:#c8d3f5;background-color:#222436;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ffc777">2697</span> <span style="color:#444a73;font-style:italic">// ListenAndServe listens on the TCP network address srv.Addr and then</span>
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2698</span> <span style="color:#444a73;font-style:italic">// calls Serve to handle requests on incoming connections.</span>
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2699</span> <span style="color:#444a73;font-style:italic">// Accepted connections are configured to enable TCP keep-alives.</span>
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2700</span> <span style="color:#444a73;font-style:italic">// If srv.Addr is blank, &#34;:http&#34; is used.</span>
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2701</span> <span style="color:#444a73;font-style:italic">// ListenAndServe always returns a non-nil error.</span>
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2702</span> <span style="color:#c099ff">func</span> (srv <span style="color:#c3e88d;font-weight:bold">*</span>Server) <span style="color:#82aaff">ListenAndServe</span>() <span style="color:#4fd6be">error</span> {
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2703</span>     addr <span style="color:#c3e88d;font-weight:bold">:=</span> srv.Addr
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2704</span>     <span style="color:#c099ff">if</span> addr <span style="color:#c3e88d;font-weight:bold">==</span> <span style="color:#c3e88d">&#34;&#34;</span> {
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2705</span>         addr = <span style="color:#c3e88d">&#34;:http&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2706</span>     }
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2707</span>     ln, err <span style="color:#c3e88d;font-weight:bold">:=</span> net.<span style="color:#82aaff">Listen</span>(<span style="color:#c3e88d">&#34;tcp&#34;</span>, addr)
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2708</span>     <span style="color:#c099ff">if</span> err <span style="color:#c3e88d;font-weight:bold">!=</span> <span style="color:#ffc777">nil</span> {
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2709</span>         <span style="color:#c099ff">return</span> err
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2710</span>     }
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2711</span>     <span style="color:#c099ff">return</span> srv.<span style="color:#82aaff">Serve</span>(tcpKeepAliveListener{ln.(<span style="color:#c3e88d;font-weight:bold">*</span>net.TCPListener)})
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2712</span> }</span></span></code></pre></div>
  <p class="sr-only">go code snippet end</p>

  
</figure>
<p>TCPサーバをListenしている。この後、<code>func (srv *Server) Serve(l net.Listener) error {}</code>や<code>func (c *conn) serve(ctx context.Context) {}</code>が順次実行され、TCPサーバとしての役割を全うするがここでは割愛する。（長いので）</p>
<p>注目したいのは、始めにインスタンス化した<code>Server</code>インスタンスが後続の処理に引き継がれていること。</p>
<ul>
<li><code>func (srv *Server) Serve(l net.Listener) error {}</code>のレシーバは<code>Server</code>のポインタ</li>
<li><code>func (c *conn) serve(ctx context.Context) {}</code>のレシーバは<code>conn</code>のポインタで、<code>conn</code>はメンバとして<code>Server</code>のポインタを保持している</li>
</ul>
<p>なぜ<code>Server</code>インスタンスが引き継がれることが重要かというと、<code>Server</code>が持っている<code>Handler</code>が後の処理で使われるため。</p>
<figure class="codeblock not-prose relative scroll-mt-8" id="codeblock-05">
  <aside
    class="absolute right-0 top-0 hidden rounded-bl-sm rounded-tr-sm bg-white/10 px-2 py-1 text-white/70 transition-opacity md:inline-block"
  >
    <div class="codeblock-meta flex max-w-xs flex-row items-center space-x-3">
      <div class="small-caps shrink cursor-default truncate font-mono text-xs" aria-hidden="true">
        <span class="relative">go</span>
      </div>
      <div>
        <clipboard-copy
          type="button"
          aria-label="Copy code to clipboard"
          title="Copy code to clipboard"
          class="block cursor-pointer transition-colors hover:text-sky-400"
          target="#codeblock-05 code"
        >
          <svg
  xmlns="http://www.w3.org/2000/svg"
  fill="none"
  stroke="currentColor"
  stroke-width="2"
  stroke-linecap="round"
  stroke-linejoin="round"
  class="lucide lucide-clipboard h-4 w-4"
  viewBox="0 0 24 24"
>
  <rect width="8" height="4" x="8" y="2" rx="1" ry="1" />
  <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" />
</svg>

        </clipboard-copy>
      </div>
      <div>
        <a
          href="#codeblock-05"
          class="block"
          aria-label="Link to this code block"
          title="Link to this code block"
        >
          <svg
  xmlns="http://www.w3.org/2000/svg"
  width="16"
  height="16"
  fill="none"
  stroke="currentColor"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  class="lucide lucide-link w-4 h-4 block"
  viewBox="0 0 24 24"
>
  <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" />
  <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" />
</svg>

        </a>
      </div>
    </div>
  </aside>
  <p class="sr-only">go code snippet start</p>
  <div class="highlight"><pre tabindex="0" style="color:#c8d3f5;background-color:#222436;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ffc777">1830</span>         serverHandler{c.server}.<span style="color:#82aaff">ServeHTTP</span>(w, w.req)</span></span></code></pre></div>
  <p class="sr-only">go code snippet end</p>

  
</figure>
<p><code>func (c *conn) serve(ctx context.Context) {}</code>の中のこの処理で、引き継がれた<code>Server</code>が持つ<code>Handler</code>インタフェースを使って、dispatchが始まる。</p>
<figure class="codeblock not-prose relative scroll-mt-8" id="codeblock-06">
  <aside
    class="absolute right-0 top-0 hidden rounded-bl-sm rounded-tr-sm bg-white/10 px-2 py-1 text-white/70 transition-opacity md:inline-block"
  >
    <div class="codeblock-meta flex max-w-xs flex-row items-center space-x-3">
      <div class="small-caps shrink cursor-default truncate font-mono text-xs" aria-hidden="true">
        <span class="relative">go</span>
      </div>
      <div>
        <clipboard-copy
          type="button"
          aria-label="Copy code to clipboard"
          title="Copy code to clipboard"
          class="block cursor-pointer transition-colors hover:text-sky-400"
          target="#codeblock-06 code"
        >
          <svg
  xmlns="http://www.w3.org/2000/svg"
  fill="none"
  stroke="currentColor"
  stroke-width="2"
  stroke-linecap="round"
  stroke-linejoin="round"
  class="lucide lucide-clipboard h-4 w-4"
  viewBox="0 0 24 24"
>
  <rect width="8" height="4" x="8" y="2" rx="1" ry="1" />
  <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" />
</svg>

        </clipboard-copy>
      </div>
      <div>
        <a
          href="#codeblock-06"
          class="block"
          aria-label="Link to this code block"
          title="Link to this code block"
        >
          <svg
  xmlns="http://www.w3.org/2000/svg"
  width="16"
  height="16"
  fill="none"
  stroke="currentColor"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  class="lucide lucide-link w-4 h-4 block"
  viewBox="0 0 24 24"
>
  <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" />
  <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" />
</svg>

        </a>
      </div>
    </div>
  </aside>
  <p class="sr-only">go code snippet start</p>
  <div class="highlight"><pre tabindex="0" style="color:#c8d3f5;background-color:#222436;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ffc777">2560</span> <span style="color:#c099ff">func</span> (sh serverHandler) <span style="color:#82aaff">ServeHTTP</span>(rw ResponseWriter, req <span style="color:#c3e88d;font-weight:bold">*</span>Request) {
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2561</span>     handler <span style="color:#c3e88d;font-weight:bold">:=</span> sh.srv.Handler
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2562</span>     <span style="color:#c099ff">if</span> handler <span style="color:#c3e88d;font-weight:bold">==</span> <span style="color:#ffc777">nil</span> {
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2563</span>         handler = DefaultServeMux
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2564</span>     }
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2565</span>     <span style="color:#c099ff">if</span> req.RequestURI <span style="color:#c3e88d;font-weight:bold">==</span> <span style="color:#c3e88d">&#34;*&#34;</span> <span style="color:#c3e88d;font-weight:bold">&amp;&amp;</span> req.Method <span style="color:#c3e88d;font-weight:bold">==</span> <span style="color:#c3e88d">&#34;OPTIONS&#34;</span> {
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2566</span>         handler = globalOptionsHandler{}
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2567</span>     }
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2568</span>     handler.<span style="color:#82aaff">ServeHTTP</span>(rw, req)
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2569</span> }</span></span></code></pre></div>
  <p class="sr-only">go code snippet end</p>

  
</figure>
<p>2561行目の<code>Handler</code>はinterfaceである。この<code>Handler</code>は、<code>http.ListenAndServe</code>関数の第２引数として指定された<code>Handler</code>である。
<code>Handler</code>インタフェースを満たしていればどんな型であってもよいので、以降は<code>Handler</code>の実装により挙動が変わることになる（！）<br>
ここからは<code>http.ListenAndServe</code>関数の第２引数を<code>nil</code>とした場合に使われるdefaultの<code>DefaultServeMux</code>の挙動を追っていく。
<code>DefaultServeMux</code>はServeMux型で、もちろんServeMux型はServeHTTPを実装しており、<code>Handler</code>インタフェースを満たす。</p>
<figure class="codeblock not-prose relative scroll-mt-8" id="codeblock-07">
  <aside
    class="absolute right-0 top-0 hidden rounded-bl-sm rounded-tr-sm bg-white/10 px-2 py-1 text-white/70 transition-opacity md:inline-block"
  >
    <div class="codeblock-meta flex max-w-xs flex-row items-center space-x-3">
      <div class="small-caps shrink cursor-default truncate font-mono text-xs" aria-hidden="true">
        <span class="relative">go</span>
      </div>
      <div>
        <clipboard-copy
          type="button"
          aria-label="Copy code to clipboard"
          title="Copy code to clipboard"
          class="block cursor-pointer transition-colors hover:text-sky-400"
          target="#codeblock-07 code"
        >
          <svg
  xmlns="http://www.w3.org/2000/svg"
  fill="none"
  stroke="currentColor"
  stroke-width="2"
  stroke-linecap="round"
  stroke-linejoin="round"
  class="lucide lucide-clipboard h-4 w-4"
  viewBox="0 0 24 24"
>
  <rect width="8" height="4" x="8" y="2" rx="1" ry="1" />
  <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" />
</svg>

        </clipboard-copy>
      </div>
      <div>
        <a
          href="#codeblock-07"
          class="block"
          aria-label="Link to this code block"
          title="Link to this code block"
        >
          <svg
  xmlns="http://www.w3.org/2000/svg"
  width="16"
  height="16"
  fill="none"
  stroke="currentColor"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  class="lucide lucide-link w-4 h-4 block"
  viewBox="0 0 24 24"
>
  <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" />
  <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" />
</svg>

        </a>
      </div>
    </div>
  </aside>
  <p class="sr-only">go code snippet start</p>
  <div class="highlight"><pre tabindex="0" style="color:#c8d3f5;background-color:#222436;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ffc777">2326</span> <span style="color:#444a73;font-style:italic">// ServeHTTP dispatches the request to the handler whose</span>
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2327</span> <span style="color:#444a73;font-style:italic">// pattern most closely matches the request URL.</span>
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2328</span> <span style="color:#c099ff">func</span> (mux <span style="color:#c3e88d;font-weight:bold">*</span>ServeMux) <span style="color:#82aaff">ServeHTTP</span>(w ResponseWriter, r <span style="color:#c3e88d;font-weight:bold">*</span>Request) {
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2329</span>     <span style="color:#c099ff">if</span> r.RequestURI <span style="color:#c3e88d;font-weight:bold">==</span> <span style="color:#c3e88d">&#34;*&#34;</span> {
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2330</span>         <span style="color:#c099ff">if</span> r.<span style="color:#82aaff">ProtoAtLeast</span>(<span style="color:#ffc777">1</span>, <span style="color:#ffc777">1</span>) {
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2331</span>             w.<span style="color:#82aaff">Header</span>().<span style="color:#82aaff">Set</span>(<span style="color:#c3e88d">&#34;Connection&#34;</span>, <span style="color:#c3e88d">&#34;close&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2332</span>         }
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2333</span>         w.<span style="color:#82aaff">WriteHeader</span>(StatusBadRequest)
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2334</span>         <span style="color:#c099ff">return</span>
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2335</span>     }
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2336</span>     h, _ <span style="color:#c3e88d;font-weight:bold">:=</span> mux.<span style="color:#82aaff">Handler</span>(r)
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2337</span>     h.<span style="color:#82aaff">ServeHTTP</span>(w, r)
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2338</span> }</span></span></code></pre></div>
  <p class="sr-only">go code snippet end</p>

  
</figure>
<p><code>mux.Handler(r)</code>で、事前に登録していたhandlerとURLのマッピング情報から実際にdispatchするhandlerを取得する。</p>
<figure class="codeblock not-prose relative scroll-mt-8" id="codeblock-08">
  <aside
    class="absolute right-0 top-0 hidden rounded-bl-sm rounded-tr-sm bg-white/10 px-2 py-1 text-white/70 transition-opacity md:inline-block"
  >
    <div class="codeblock-meta flex max-w-xs flex-row items-center space-x-3">
      <div class="small-caps shrink cursor-default truncate font-mono text-xs" aria-hidden="true">
        <span class="relative">go</span>
      </div>
      <div>
        <clipboard-copy
          type="button"
          aria-label="Copy code to clipboard"
          title="Copy code to clipboard"
          class="block cursor-pointer transition-colors hover:text-sky-400"
          target="#codeblock-08 code"
        >
          <svg
  xmlns="http://www.w3.org/2000/svg"
  fill="none"
  stroke="currentColor"
  stroke-width="2"
  stroke-linecap="round"
  stroke-linejoin="round"
  class="lucide lucide-clipboard h-4 w-4"
  viewBox="0 0 24 24"
>
  <rect width="8" height="4" x="8" y="2" rx="1" ry="1" />
  <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" />
</svg>

        </clipboard-copy>
      </div>
      <div>
        <a
          href="#codeblock-08"
          class="block"
          aria-label="Link to this code block"
          title="Link to this code block"
        >
          <svg
  xmlns="http://www.w3.org/2000/svg"
  width="16"
  height="16"
  fill="none"
  stroke="currentColor"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  class="lucide lucide-link w-4 h-4 block"
  viewBox="0 0 24 24"
>
  <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" />
  <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" />
</svg>

        </a>
      </div>
    </div>
  </aside>
  <p class="sr-only">go code snippet start</p>
  <div class="highlight"><pre tabindex="0" style="color:#c8d3f5;background-color:#222436;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ffc777">2133</span> <span style="color:#c099ff">type</span> ServeMux <span style="color:#c099ff">struct</span> {
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2134</span>     mu    sync.RWMutex
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2135</span>     m     <span style="color:#c099ff">map</span>[<span style="color:#4fd6be">string</span>]muxEntry
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2136</span>     hosts <span style="color:#4fd6be">bool</span> <span style="color:#444a73;font-style:italic">// whether any patterns contain hostnames</span>
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2137</span> }
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2138</span>
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2139</span> <span style="color:#c099ff">type</span> muxEntry <span style="color:#c099ff">struct</span> {
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2140</span>     h       Handler
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2141</span>     pattern <span style="color:#4fd6be">string</span>
</span></span><span style="display:flex;"><span><span style="color:#ffc777">2142</span> }</span></span></code></pre></div>
  <p class="sr-only">go code snippet end</p>

  
</figure>
<p><code>ServeMux</code>型は、キーがURLパターン、バリューが<code>Handler</code>を持つ<code>muxEntry</code>、なmap構造を持っており、ここにhandlerとURLのマッピング情報を保持している。<br>
実は<code>http.HandleFunc()</code>や<code>http.Handle()</code>では、この<code>ServeMux</code>型のmにURLパターンとhandlerのマッピング情報が登録されている。</p>
<p>最後に取得したhandlerが実行される。</p>
<p><a name="anchor"></a></p>
<h2 id="主要な構成要素とhandlerインタフェース" class="scroll-mt-8 group">
  主要な構成要素とHandlerインタフェース
  
    <a href="#%e4%b8%bb%e8%a6%81%e3%81%aa%e6%a7%8b%e6%88%90%e8%a6%81%e7%b4%a0%e3%81%a8handler%e3%82%a4%e3%83%b3%e3%82%bf%e3%83%95%e3%82%a7%e3%83%bc%e3%82%b9"
        class="no-underline hidden opacity-50 hover:opacity-100 !text-inherit group-hover:inline-block"
        aria-hidden="true" title="Link to this heading" tabindex="-1">
        <svg
  xmlns="http://www.w3.org/2000/svg"
  width="16"
  height="16"
  fill="none"
  stroke="currentColor"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  class="lucide lucide-link w-4 h-4 block"
  viewBox="0 0 24 24"
>
  <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" />
  <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" />
</svg>

    </a>
  
</h2>
<p>ここまで、雑に標準のhttpサーバの挙動を追ったが、ごちゃごちゃしているので主要な構成要素について<code>Handler</code>インタフェースとの関わりという観点で整理する。</p>
<table>
  <thead>
      <tr>
          <th>型</th>
          <th style="text-align: center"><code>Handler</code>インタフェースとの関わり</th>
          <th style="text-align: right">役割</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>http.Server</code></td>
          <td style="text-align: center"><code>Handler</code>インタフェースを持つ</td>
          <td style="text-align: right">TCPサーバ。handlerのディスパッチが始まるエントリポイント。Request、Responseを生成した後、持っている<code>Handler</code>インタフェースの<code>ServeHTTP</code>メソッドを呼び出す。</td>
      </tr>
      <tr>
          <td><code>http.ServeMux</code>  <code>http.DefaultServeMux</code>の型</td>
          <td style="text-align: center"><code>Handler</code>インタフェースを満たす。    <code>m map[string]muxEntry</code>に<code>Handler</code>が登録してある</td>
          <td style="text-align: right"><code>Server</code>に呼び出される。URLにマッチするhandlerを<code>m map[string]muxEntry</code>から取得し、そのhandlerの<code>ServeHTTP</code>メソッドを呼び出す。</td>
      </tr>
      <tr>
          <td><code>http.muxEntry</code>の<code>Handler</code></td>
          <td style="text-align: center"><code>Handler</code>インタフェースを満たす</td>
          <td style="text-align: right"><code>ServeMux</code>に呼び出される。<code>http.Handle()</code>や<code>http.HandleFunc</code>で登録される<code>Handler</code>インタフェースの正体がこれ。</td>
      </tr>
  </tbody>
</table>
<p>リクエストを受けてからhandlerがdispatchされるまでに、異なるレイヤで異なる働きをするものが実行されるが、レイヤ間の処理の受け渡しに<code>Handler</code>インタフェースが使われていることがわかる。</p>
<p>つまり、ライブラリやフレームワークを実現するためには、<code>Handler</code>を持つ、もしくは<code>Handler</code>を満たすコンポーネントを開発してどこかのレイヤの実装を置き換える、または拡張すればよい。</p>
<p>なので、フレームワークやライブラリが何をやっているか知りたいときは、<code>ServeHTTP</code>でgrepしてみるとよい。<code>ServeHTTP</code>メソッドを読んでみて、どのレイヤの処理を置き換えたり拡張したりしているのか考えると雰囲気が掴みやすい。</p>
<h2 id="ライブラリやフレームワークの雰囲気" class="scroll-mt-8 group">
  ライブラリやフレームワークの雰囲気
  
    <a href="#%e3%83%a9%e3%82%a4%e3%83%96%e3%83%a9%e3%83%aa%e3%82%84%e3%83%95%e3%83%ac%e3%83%bc%e3%83%a0%e3%83%af%e3%83%bc%e3%82%af%e3%81%ae%e9%9b%b0%e5%9b%b2%e6%b0%97"
        class="no-underline hidden opacity-50 hover:opacity-100 !text-inherit group-hover:inline-block"
        aria-hidden="true" title="Link to this heading" tabindex="-1">
        <svg
  xmlns="http://www.w3.org/2000/svg"
  width="16"
  height="16"
  fill="none"
  stroke="currentColor"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  class="lucide lucide-link w-4 h-4 block"
  viewBox="0 0 24 24"
>
  <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" />
  <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" />
</svg>

    </a>
  
</h2>
<h3 id="middleware" class="scroll-mt-8 group">
  middleware
  
    <a href="#middleware"
        class="no-underline hidden opacity-50 hover:opacity-100 !text-inherit group-hover:inline-block"
        aria-hidden="true" title="Link to this heading" tabindex="-1">
        <svg
  xmlns="http://www.w3.org/2000/svg"
  width="16"
  height="16"
  fill="none"
  stroke="currentColor"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  class="lucide lucide-link w-4 h-4 block"
  viewBox="0 0 24 24"
>
  <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" />
  <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" />
</svg>

    </a>
  
</h3>
<p>middlewareは、前章の<code>muxEntry</code>の<code>Handler</code>のレイヤの処理の拡張を行うことで、様々なhandler間で共通の処理を上手く書くことできる。
具体的にどう実装するか、は以下の記事に詳しい説明がある。</p>
<p><a href="https://www.nicolasmerouze.com/middlewares-golang-best-practices-examples/">Middlewares in Go: Best practices and examples</a><br>
<a href="http://www.alexedwards.net/blog/making-and-using-middleware">Making and Using HTTP Middleware</a><br>
<a href="https://justinas.org/writing-http-middleware-in-go/">Writing HTTP Middleware in Go</a></p>
<p><code>Handler</code>インタフェースを利用した、Decoratorパターンで実現できる。</p>
<p>サードパーティだと<a href="https://github.com/gorilla/handlers">gorilla/handlers</a>のようなものがある。</p>
<h3 id="router" class="scroll-mt-8 group">
  router
  
    <a href="#router"
        class="no-underline hidden opacity-50 hover:opacity-100 !text-inherit group-hover:inline-block"
        aria-hidden="true" title="Link to this heading" tabindex="-1">
        <svg
  xmlns="http://www.w3.org/2000/svg"
  width="16"
  height="16"
  fill="none"
  stroke="currentColor"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  class="lucide lucide-link w-4 h-4 block"
  viewBox="0 0 24 24"
>
  <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" />
  <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" />
</svg>

    </a>
  
</h3>
<p>routerは、前章の<code>ServeMux</code>のレイヤの処理の実装を別のコンポーネントに置き換える。
<a href="https://github.com/gorilla/mux">gorilla/mux</a>や<a href="https://github.com/julienschmidt/httprouter">julienschmidt/httprouter</a>のようなものがある。<code>ServeMux</code>レイヤの処理を置き換えるので、ライブラリ独自のroutingを保持するデータ構造を持っていて、<code>ServeHTTP</code>メソッドの中で独自のroutingロジックを実装している。ここのroutingのロジックの実装をいい感じにすることで、個別のHTTPメソッドに対してhandlerを登録したり、path parameterのハンドリングができるようになる。</p>
<p>ちなみに、<code>ServeMux</code>のレイヤの処理の実装を置き換えるので、それ以降の<code>muxEntry</code>の<code>Handler</code>レイヤの処理は必ずしも<code>Handler</code>インタフェースを満たしている必要はない。ライブラリ側でシグネチャを変えることもできるし、もちろん変えなくてもよい。</p>
<h3 id="その他" class="scroll-mt-8 group">
  その他
  
    <a href="#%e3%81%9d%e3%81%ae%e4%bb%96"
        class="no-underline hidden opacity-50 hover:opacity-100 !text-inherit group-hover:inline-block"
        aria-hidden="true" title="Link to this heading" tabindex="-1">
        <svg
  xmlns="http://www.w3.org/2000/svg"
  width="16"
  height="16"
  fill="none"
  stroke="currentColor"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  class="lucide lucide-link w-4 h-4 block"
  viewBox="0 0 24 24"
>
  <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" />
  <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" />
</svg>

    </a>
  
</h3>
<p>有名なフレームワークに、<a href="https://github.com/labstack/echo">labstack/echo</a>がある。このフレームワークでは、エントリポイントである<code>http.Server</code>をラップした<code>Echo</code>というコンポーネントで全ての処理を置き換えている。</p>
<figure class="codeblock not-prose relative scroll-mt-8" id="codeblock-09">
  <aside
    class="absolute right-0 top-0 hidden rounded-bl-sm rounded-tr-sm bg-white/10 px-2 py-1 text-white/70 transition-opacity md:inline-block"
  >
    <div class="codeblock-meta flex max-w-xs flex-row items-center space-x-3">
      <div class="small-caps shrink cursor-default truncate font-mono text-xs" aria-hidden="true">
        <span class="relative">go</span>
      </div>
      <div>
        <clipboard-copy
          type="button"
          aria-label="Copy code to clipboard"
          title="Copy code to clipboard"
          class="block cursor-pointer transition-colors hover:text-sky-400"
          target="#codeblock-09 code"
        >
          <svg
  xmlns="http://www.w3.org/2000/svg"
  fill="none"
  stroke="currentColor"
  stroke-width="2"
  stroke-linecap="round"
  stroke-linejoin="round"
  class="lucide lucide-clipboard h-4 w-4"
  viewBox="0 0 24 24"
>
  <rect width="8" height="4" x="8" y="2" rx="1" ry="1" />
  <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" />
</svg>

        </clipboard-copy>
      </div>
      <div>
        <a
          href="#codeblock-09"
          class="block"
          aria-label="Link to this code block"
          title="Link to this code block"
        >
          <svg
  xmlns="http://www.w3.org/2000/svg"
  width="16"
  height="16"
  fill="none"
  stroke="currentColor"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  class="lucide lucide-link w-4 h-4 block"
  viewBox="0 0 24 24"
>
  <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" />
  <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" />
</svg>

        </a>
      </div>
    </div>
  </aside>
  <p class="sr-only">go code snippet start</p>
  <div class="highlight"><pre tabindex="0" style="color:#c8d3f5;background-color:#222436;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>Echo <span style="color:#c099ff">struct</span> {
</span></span><span style="display:flex;"><span>		stdLogger        <span style="color:#c3e88d;font-weight:bold">*</span>stdLog.Logger
</span></span><span style="display:flex;"><span>		colorer          <span style="color:#c3e88d;font-weight:bold">*</span>color.Color
</span></span><span style="display:flex;"><span>		premiddleware    []MiddlewareFunc
</span></span><span style="display:flex;"><span>		middleware       []MiddlewareFunc
</span></span><span style="display:flex;"><span>		maxParam         <span style="color:#c3e88d;font-weight:bold">*</span><span style="color:#4fd6be">int</span>
</span></span><span style="display:flex;"><span>		router           <span style="color:#c3e88d;font-weight:bold">*</span>Router
</span></span><span style="display:flex;"><span>		notFoundHandler  HandlerFunc
</span></span><span style="display:flex;"><span>		pool             sync.Pool
</span></span><span style="display:flex;"><span>		Server           <span style="color:#c3e88d;font-weight:bold">*</span>http.Server
</span></span><span style="display:flex;"><span>		TLSServer        <span style="color:#c3e88d;font-weight:bold">*</span>http.Server
</span></span><span style="display:flex;"><span>		Listener         net.Listener
</span></span><span style="display:flex;"><span>		TLSListener      net.Listener
</span></span><span style="display:flex;"><span>		AutoTLSManager   autocert.Manager
</span></span><span style="display:flex;"><span>		DisableHTTP2     <span style="color:#4fd6be">bool</span>
</span></span><span style="display:flex;"><span>		Debug            <span style="color:#4fd6be">bool</span>
</span></span><span style="display:flex;"><span>		HideBanner       <span style="color:#4fd6be">bool</span>
</span></span><span style="display:flex;"><span>		HidePort         <span style="color:#4fd6be">bool</span>
</span></span><span style="display:flex;"><span>		HTTPErrorHandler HTTPErrorHandler
</span></span><span style="display:flex;"><span>		Binder           Binder
</span></span><span style="display:flex;"><span>		Validator        Validator
</span></span><span style="display:flex;"><span>		Renderer         Renderer
</span></span><span style="display:flex;"><span>		Logger           Logger
</span></span><span style="display:flex;"><span>	}</span></span></code></pre></div>
  <p class="sr-only">go code snippet end</p>

  
</figure>
<p>TCPサーバとしての<code>Server</code>型のみ利用しており、<code>Server</code>型から<code>http.ServeMux</code>レイヤを呼び出すところのみ<code>Handler</code>インタフェースを使っているが、それ以外のところでは独自のシグネチャを採用している。</p>
<p>以下は、echoのページにあるサンプル。</p>
<figure class="codeblock not-prose relative scroll-mt-8" id="codeblock-10">
  <aside
    class="absolute right-0 top-0 hidden rounded-bl-sm rounded-tr-sm bg-white/10 px-2 py-1 text-white/70 transition-opacity md:inline-block"
  >
    <div class="codeblock-meta flex max-w-xs flex-row items-center space-x-3">
      <div class="small-caps shrink cursor-default truncate font-mono text-xs" aria-hidden="true">
        <span class="relative"></span>
      </div>
      <div>
        <clipboard-copy
          type="button"
          aria-label="Copy code to clipboard"
          title="Copy code to clipboard"
          class="block cursor-pointer transition-colors hover:text-sky-400"
          target="#codeblock-10 code"
        >
          <svg
  xmlns="http://www.w3.org/2000/svg"
  fill="none"
  stroke="currentColor"
  stroke-width="2"
  stroke-linecap="round"
  stroke-linejoin="round"
  class="lucide lucide-clipboard h-4 w-4"
  viewBox="0 0 24 24"
>
  <rect width="8" height="4" x="8" y="2" rx="1" ry="1" />
  <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" />
</svg>

        </clipboard-copy>
      </div>
      <div>
        <a
          href="#codeblock-10"
          class="block"
          aria-label="Link to this code block"
          title="Link to this code block"
        >
          <svg
  xmlns="http://www.w3.org/2000/svg"
  width="16"
  height="16"
  fill="none"
  stroke="currentColor"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  class="lucide lucide-link w-4 h-4 block"
  viewBox="0 0 24 24"
>
  <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" />
  <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" />
</svg>

        </a>
      </div>
    </div>
  </aside>
  <p class="sr-only"> code snippet start</p>
  <pre tabindex="0"><code>package main

import (
	&#34;net/http&#34;

	&#34;github.com/labstack/echo&#34;
	&#34;github.com/labstack/echo/middleware&#34;
)

func main() {
	// Echo instance
	e := echo.New()

	// Middleware
	e.Use(middleware.Logger())
	e.Use(middleware.Recover())

	// Routes
	e.GET(&#34;/&#34;, hello)

	// Start server
	e.Logger.Fatal(e.Start(&#34;:1323&#34;))
}

// Handler
func hello(c echo.Context) error {
	return c.String(http.StatusOK, &#34;Hello, World!&#34;)
}</code></pre>
  <p class="sr-only"> code snippet end</p>

  
</figure>
<p>httpサーバの起動は<code>e.Start(&quot;:1323&quot;)</code>という独自の実装となっている。また、echoへのhandlerの登録は、httpパッケージの<code>Handler</code>インタフェースではなく、独自のシグネチャとなっていることがわかる。</p>
<h2 id="まとめ" class="scroll-mt-8 group">
  まとめ
  
    <a href="#%e3%81%be%e3%81%a8%e3%82%81"
        class="no-underline hidden opacity-50 hover:opacity-100 !text-inherit group-hover:inline-block"
        aria-hidden="true" title="Link to this heading" tabindex="-1">
        <svg
  xmlns="http://www.w3.org/2000/svg"
  width="16"
  height="16"
  fill="none"
  stroke="currentColor"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  class="lucide lucide-link w-4 h-4 block"
  viewBox="0 0 24 24"
>
  <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" />
  <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" />
</svg>

    </a>
  
</h2>
<ul>
<li>Goでのhttpサーバの肝は<code>Handler</code>インタフェースなので、<code>Handler</code>インタフェースを中心に考えると雰囲気が掴みやすい。</li>
<li><code>Handler</code>インタフェースの実装（=<code>ServeHTTP</code>）を追えば、各ライブラリやフレームワークが何をやっているか、雰囲気を掴める。</li>
<li><code>Handler</code>というシンプルなインタフェースだけで拡張性や柔軟性をもたらしていて、すごい。</li>
</ul>
<h2 id="参考" class="scroll-mt-8 group">
  参考
  
    <a href="#%e5%8f%82%e8%80%83"
        class="no-underline hidden opacity-50 hover:opacity-100 !text-inherit group-hover:inline-block"
        aria-hidden="true" title="Link to this heading" tabindex="-1">
        <svg
  xmlns="http://www.w3.org/2000/svg"
  width="16"
  height="16"
  fill="none"
  stroke="currentColor"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  class="lucide lucide-link w-4 h-4 block"
  viewBox="0 0 24 24"
>
  <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" />
  <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" />
</svg>

    </a>
  
</h2>
<ul>
<li><a href="https://www.nicolasmerouze.com/middlewares-golang-best-practices-examples/">Middlewares in Go: Best practices and examples</a></li>
<li><a href="http://www.alexedwards.net/blog/making-and-using-middleware">Making and Using HTTP Middleware</a></li>
<li><a href="https://justinas.org/writing-http-middleware-in-go/">Writing HTTP Middleware in Go</a></li>
<li><a href="https://github.com/gorilla/handlers">gorilla/handlers</a></li>
<li><a href="https://github.com/gorilla/mux">gorilla/mux</a></li>
<li><a href="https://github.com/julienschmidt/httprouter">julienschmidt/httprouter</a></li>
<li><a href="https://github.com/labstack/echo">labstack/echo</a></li>
</ul>
  </article>
    <aside class="not-prose flex flex-col space-y-8 border-t pt-6">
    <section class="flex flex-col space-y-4">
      <h2 class="flex flex-row items-center space-x-2 text-lg font-semibold">
        <svg
  xmlns="http://www.w3.org/2000/svg"
  fill="none"
  stroke="currentColor"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  class="lucide lucide-tags h-4 w-4"
  viewBox="0 0 24 24"
  aria-hidden="true"
>
  <path d="m15 5 6.3 6.3a2.4 2.4 0 0 1 0 3.4L17 19" />
  <path
    d="M9.586 5.586A2 2 0 0 0 8.172 5H3a1 1 0 0 0-1 1v5.172a2 2 0 0 0 .586 1.414L8.29 18.29a2.426 2.426 0 0 0 3.42 0l3.58-3.58a2.426 2.426 0 0 0 0-3.42z"
  />
  <circle cx="6.5" cy="9.5" r=".5" fill="currentColor" />
</svg>

        <span>Tags</span>
      </h2>

      <ul class="not-prose ml-6 flex flex-row flex-wrap items-center space-x-2">
          <li>
            <a href="/tags/golang/" class="taxonomy tag">golang</a>
          </li>
          <li>
            <a href="/tags/http/" class="taxonomy tag">http</a>
          </li>
      </ul>
    </section>
    <section class="flex flex-col space-y-4" aria-hidden="true">
      <h2 class="flex flex-row items-center space-x-2 text-lg font-semibold">
        <svg
  xmlns="http://www.w3.org/2000/svg"
  fill="none"
  stroke="currentColor"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  class="lucide lucide-chart-network h-4 w-4"
  viewBox="0 0 24 24"
  aria-hidden="true"
>
  <path
    d="m13.11 7.664 1.78 2.672M14.162 12.788l-3.324 1.424M20 4l-6.06 1.515M3 3v16a2 2 0 0 0 2 2h16"
  />
  <circle cx="12" cy="6" r="2" />
  <circle cx="16" cy="12" r="2" />
  <circle cx="9" cy="15" r="2" />
</svg>

        <span>Graph</span>
      </h2>

      <content-network-graph
  class="h-64 ml-6"
  data-endpoint="/graph/index.json"
  page="/posts/go-http-server-overview/"
></content-network-graph>

    </section>
    <section class="flex flex-col space-y-4">
      <h2 class="flex flex-row items-center space-x-2 text-lg font-semibold">
        <svg
  xmlns="http://www.w3.org/2000/svg"
  fill="none"
  stroke="currentColor"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  class="lucide lucide-newspaper h-4 w-4"
  viewBox="0 0 24 24"
  aria-hidden="true"
>
  <path
    d="M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v16a2 2 0 0 1-2 2Zm0 0a2 2 0 0 1-2-2v-9c0-1.1.9-2 2-2h2M18 14h-8M15 18h-5"
  />
  <path d="M10 6h8v4h-8V6Z" />
</svg>

        <span>Posts</span>
      </h2>
        <section class="flex flex-col space-y-1">
          <h3 class="flex flex-row items-center space-x-2 text-sm font-semibold">
            <svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 256 256"
  class="h-4 w-4"
  aria-hidden="true"
>
  <path
    fill="currentColor"
    d="M222.16 153.26a8 8 0 0 1-1 11.25c-17.36 14.38-32.86 19.49-47 19.49-18.58 0-34.82-8.81-49.93-17-25.35-13.75-47.24-25.63-79.07.74a8 8 0 1 1-10.22-12.3c40.17-33.27 70.32-16.92 96.93-2.48 25.35 13.75 47.24 25.62 79.07-.75a8 8 0 0 1 11.22 1.05m-177-49.46c31.83-26.37 53.72-14.5 79.07-.75 15.11 8.2 31.35 17 49.93 17 14.14 0 29.64-5.11 47-19.49a8 8 0 1 0-10.22-12.3c-31.83 26.37-53.72 14.49-79.07.74-26.61-14.43-56.76-30.79-96.93 2.48a8 8 0 0 0 10.17 12.32Z"
  />
</svg>

            <span>Related</span>
          </h3>

          <ol class="not-prose ml-6">
    <li>
      <article class="flex flex-row items-center">
        <header class="grow">
          <h3>
            <a
              href="/posts/for-goroutine/"
              class="truncate text-sm underline decoration-slate-300 decoration-2 underline-offset-4 hover:decoration-inherit"
              title="for文の中でmethodをgoroutine化する"
              >For文の中でmethodをgoroutine化する</a
            >
          </h3>
        </header>
      </article>
    </li>
</ol>

        </section>
    </section>
</aside>


      </main>
      <footer class="mt-20 border-t border-neutral-100 pt-2 text-xs">
        <section class="items-top flex flex-row justify-between opacity-70">
  <div class="flex flex-col space-y-2">
      <p>Copyright &copy; 2025, Takafumi Tsukamoto.</p>

  </div>
    <div>
      <a
        href="https://github.com/michenriksen/hugo-theme-til"
        title="Today I Learned &#8212; A Hugo theme by Michael Henriksen"
        data-theme-version="0.6.0"
        >theme: til</a
      >
    </div>
</section>

      </footer>
    </div>
    
  </body>
</html>
